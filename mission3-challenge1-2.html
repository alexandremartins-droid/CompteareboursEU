<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>The Laboratory · Challenge 1</title>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;600;700;900&family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #071a3a;
      --text: #d4e7ff;
      --muted: rgba(212,231,255,0.78);
      --muted2: rgba(212,231,255,0.64);
      --title: #ffffff;

      --cyan: #19dfff;
      --blue: #2aa8ff;

      --card: rgba(255,255,255,0.06);
      --cardBorder: rgba(255,255,255,0.10);

      --shadow: 0 0 20px rgba(0,0,0,0.35);
    }

    html, body{
      margin:0;
      padding:40px;
      background: transparent !important;
      color: var(--text);
      font-family: 'Inter', sans-serif;
      overflow-x:hidden;
    }

    .header-badge{
      display:inline-block;
      padding:6px 14px;
      font-size:12px;
      border-radius:20px;
      border:1px solid var(--blue);
      color:var(--blue);
      margin-bottom:16px;
      letter-spacing:1px;
      text-transform:uppercase;
      background: rgba(0,0,0,0.20);
      box-shadow: 0 0 0 1px rgba(255,255,255,0.04);
    }

    h1{
      font-family:'Orbitron', sans-serif;
      font-size:52px;
      font-weight:900;
      letter-spacing:2px;
      color:var(--title);
      margin:0 0 12px 0;
    }

    /* mission-like subtitle */
    .subtitle{
      max-width:1100px;
      margin:0 0 22px 0;
      color: var(--muted);
      font-size:20px;
      line-height:1.55;
      position:relative;
      padding-left:14px;
    }
    .subtitle::before{
      content:"";
      position:absolute;
      left:0;
      top:6px;
      bottom:6px;
      width:3px;
      border-radius:999px;
      background: linear-gradient(to bottom, rgba(25,223,255,0.0), rgba(25,223,255,0.95), rgba(25,223,255,0.0));
      box-shadow: 0 0 18px rgba(25,223,255,0.25);
    }

    .wrap{ max-width: 1280px; }

    /* ====== LAYOUT: services list + leagues ====== */
    .lab-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:20px;
      margin-top:18px;
    }
    @media (min-width: 1100px){
      .lab-grid{
        grid-template-columns: 1.08fr 1.92fr;
        align-items:start;
      }
    }

    .panel{
      background: rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:22px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.03);
      overflow:hidden;
    }
    .panel-inner{ padding:18px; }

    .panel-title{
      font-family:'Orbitron', sans-serif;
      color:#ffffff;
      letter-spacing:2px;
      text-transform:uppercase;
      font-size:16px;
      margin:0 0 12px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .hint{
      font-size:13px;
      color: rgba(212,231,255,0.70);
      letter-spacing: .2px;
      text-transform:none;
      font-family:'Inter', sans-serif;
      font-weight:500;
    }

    /* Search */
    .search{
      display:flex;
      gap:10px;
      align-items:center;
      margin:10px 0 14px 0;
    }
    .search input{
      width:100%;
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.22);
      color: var(--text);
      outline:none;
      font-size:14px;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    .search input:focus{
      border-color: rgba(25,223,255,0.35);
      box-shadow: 0 0 0 3px rgba(25,223,255,0.08);
    }
    .pill-mini{
      flex:0 0 auto;
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(25,223,255,0.28);
      color: rgba(212,231,255,0.85);
      background: rgba(25,223,255,0.06);
      user-select:none;
    }

    /* Sections */
    .svc-section{
      margin:14px 0 0 0;
      padding-top:14px;
      border-top:1px solid rgba(255,255,255,0.08);
    }
    .svc-section:first-of-type{
      margin-top:0;
      padding-top:0;
      border-top:none;
    }
    .svc-h{
      font-family:'Orbitron', sans-serif;
      font-size:14px;
      letter-spacing:1.8px;
      text-transform:uppercase;
      color: rgba(212,231,255,0.92);
      margin:0 0 10px 0;
    }
    .svc-list{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }

    /* Service chip (draggable + clickable) */
    .svc{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.05);
      color: rgba(212,231,255,0.92);
      font-size:14px;
      line-height:1.15;
      cursor: grab;
      user-select:none;
      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease, background .18s ease;
      position:relative;
      max-width: 100%;
    }
    .svc:hover{
      transform: translateY(-2px);
      border-color: rgba(25,223,255,0.26);
      box-shadow: 0 0 18px rgba(25,223,255,0.10);
      background: rgba(25,223,255,0.06);
    }
    .svc:active{ cursor: grabbing; transform: translateY(-1px) scale(0.99); }
    .svc .dot{
      width:10px; height:10px; border-radius:50%;
      background: rgba(25,223,255,0.95);
      box-shadow: 0 0 14px rgba(25,223,255,0.25);
      flex:0 0 auto;
    }
    .svc .label{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width: 320px; }
    @media (max-width: 420px){
      .svc .label{ max-width: 220px; }
    }

    /* Assigned state */
    .svc[data-assigned="true"]{
      border-color: rgba(25,223,255,0.22);
      background: rgba(0,0,0,0.18);
      opacity: 0.95;
    }
    .svc[data-assigned="true"] .dot{ background: rgba(42,168,255,0.95); }

    /* Leagues area */
    .leagues{
      display:grid;
      grid-template-columns: 1fr;
      gap:18px;
    }
    @media (min-width: 900px){
      .leagues{ grid-template-columns: repeat(2, 1fr); }
    }

    .league{
      background: rgba(0,0,0,0.20);
      border:1px solid rgba(255,255,255,0.10);
      border-radius:22px;
      padding:14px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.03);
      overflow:hidden;
      min-height: 220px;
      position:relative;
    }

    .league-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    .league-name{
      font-family:'Orbitron', sans-serif;
      color:#ffffff;
      letter-spacing:2px;
      text-transform:uppercase;
      font-size:14px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .league-badge{
      width:10px; height:10px; border-radius:50%;
      background: var(--cyan);
      box-shadow: 0 0 16px rgba(25,223,255,0.30);
    }
    .league-count{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.18);
      color: rgba(212,231,255,0.80);
      user-select:none;
    }

    /* League thumbnail header (uses your existing images 1..4) */
    .league-thumb{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.25);
      aspect-ratio: 16 / 7;
    }
    .league-thumb img{
      width:100%; height:100%; object-fit:cover; display:block;
      transform: scale(1);
      transition: transform .35s ease, filter .35s ease;
    }
    .league:hover .league-thumb img{
      transform: scale(1.05);
      filter: saturate(1.12) contrast(1.05);
    }

    .league-desc{
      margin:10px 0 12px 0;
      color: rgba(212,231,255,0.82);
      font-size:14px;
      line-height:1.45;
    }

    /* Drop zone */
    .dropzone{
      border-radius:18px;
      border:1px dashed rgba(25,223,255,0.22);
      background: rgba(25,223,255,0.04);
      padding:12px;
      min-height: 86px;
      transition: border-color .18s ease, box-shadow .18s ease, background .18s ease;
    }
    .dropzone.is-over{
      border-color: rgba(25,223,255,0.55);
      box-shadow: 0 0 24px rgba(25,223,255,0.12);
      background: rgba(25,223,255,0.08);
    }
    .dropzone-empty{
      margin:0;
      color: rgba(212,231,255,0.60);
      font-size:13px;
      line-height:1.45;
    }
    .assigned-list{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }

    /* Small remove button on assigned chips */
    .svc .x{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:18px;
      height:18px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.14);
      color: rgba(212,231,255,0.80);
      font-size:12px;
      margin-left:2px;
      background: rgba(0,0,0,0.22);
      transition: transform .16s ease, border-color .16s ease, background .16s ease;
      cursor:pointer;
    }
    .svc .x:hover{
      transform: scale(1.06);
      border-color: rgba(25,223,255,0.35);
      background: rgba(25,223,255,0.08);
    }

    /* CTA */
    .cta{
      display:flex;
      justify-content:center;
      margin-top:22px;
    }
    .btn-go{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:16px 40px;
      border-radius:999px;
      border:1px solid rgba(25,223,255,0.55);
      background: var(--cyan);
      color:#ffffff;
      font-family:'Orbitron', sans-serif;
      font-size:22px;
      font-weight:900;
      letter-spacing:2px;
      text-transform:uppercase;
      cursor:pointer;
      transition: transform .22s ease, box-shadow .22s ease, filter .22s ease;
      box-shadow: 0 0 22px rgba(25,223,255,0.18);
    }
    .btn-go:hover{
      transform: translateY(-2px);
      box-shadow: 0 0 28px rgba(25,223,255,0.28);
      filter: brightness(1.05);
    }
    .btn-go:active{
      transform: translateY(-2px);
      box-shadow: 0 0 28px rgba(25,223,255,0.28);
    }

    /* Tiny toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(14px);
      opacity:0;
      pointer-events:none;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(25,223,255,0.28);
      background: rgba(0,0,0,0.55);
      color: rgba(212,231,255,0.92);
      font-size:13px;
      box-shadow: 0 0 22px rgba(0,0,0,0.25);
      transition: opacity .22s ease, transform .22s ease;
      z-index: 9999;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(0);
    }

    /* Click-assign modal (mobile-friendly) */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 9998;
      padding:18px;
    }
    .modal{
      width: min(520px, 100%);
      border-radius:22px;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(8,18,40,0.92);
      box-shadow: 0 0 38px rgba(0,0,0,0.45);
      overflow:hidden;
    }
    .modal-top{
      padding:16px 16px 12px 16px;
      border-bottom:1px solid rgba(255,255,255,0.08);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .modal-title{
      margin:0;
      font-family:'Orbitron', sans-serif;
      font-size:16px;
      letter-spacing:1.8px;
      text-transform:uppercase;
      color:#fff;
    }
    .modal-sub{
      margin:8px 0 0 0;
      color: rgba(212,231,255,0.78);
      font-size:14px;
      line-height:1.45;
    }
    .modal-x{
      appearance:none;
      border:none;
      background: transparent;
      color: rgba(212,231,255,0.78);
      font-size:20px;
      cursor:pointer;
      padding:2px 6px;
      line-height:1;
    }
    .modal-body{ padding:14px 16px 16px 16px; }
    .pick{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 520px){
      .pick{ grid-template-columns: 1fr 1fr; }
    }
    .pick button{
      appearance:none;
      border:1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color:#fff;
      border-radius:16px;
      padding:12px 12px;
      cursor:pointer;
      font-family:'Orbitron', sans-serif;
      letter-spacing:1.6px;
      text-transform:uppercase;
      font-size:13px;
      transition: transform .18s ease, border-color .18s ease, box-shadow .18s ease, background .18s ease;
      text-align:left;
    }
    .pick button:hover{
      transform: translateY(-2px);
      border-color: rgba(25,223,255,0.30);
      box-shadow: 0 0 18px rgba(25,223,255,0.10);
      background: rgba(25,223,255,0.08);
    }

    .sr-only{
      position:absolute;
      width:1px; height:1px;
      padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0);
      white-space:nowrap; border:0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header-badge">Mission Connected Heroes · The Laboratory</div>

    <h1>The Laboratory · Challenge 1</h1>
    <p class="subtitle">
      Help us define the <b>commercial packages</b> of tomorrow by associating each service with a <b>league</b>.
      Drag & drop a service into a league (or click a service to assign it).
    </p>

    <div class="lab-grid">

      <!-- SERVICES LIST -->
      <aside class="panel" aria-label="Services list">
        <div class="panel-inner">
          <div class="panel-title">
            Services
            <span class="hint">Drag • Drop • Click</span>
          </div>

          <div class="search">
            <input id="search" type="text" placeholder="Search a service…" autocomplete="off" />
            <span class="pill-mini" id="countPill">0</span>
          </div>

          <div id="servicesRoot">
            <!-- injected by JS -->
          </div>
        </div>
      </aside>

      <!-- LEAGUES -->
      <section class="leagues" aria-label="Leagues">
        <!-- Essentials -->
        <div class="league" data-league="essentials">
          <div class="league-head">
            <div class="league-name"><span class="league-badge"></span> League Essentials</div>
            <div class="league-count" id="count-essentials">0</div>
          </div>
          <div class="league-thumb">
            <img src="1.png" alt="League Essentials">
          </div>
          <p class="league-desc">The key basics required in your car</p>
          <div class="dropzone" data-drop="essentials" aria-label="Drop services into League Essentials">
            <p class="dropzone-empty">Drop services here.</p>
            <div class="assigned-list" id="list-essentials"></div>
          </div>
        </div>

        <!-- Entertainment -->
        <div class="league" data-league="entertainment">
          <div class="league-head">
            <div class="league-name"><span class="league-badge" style="background:#2aa8ff; box-shadow:0 0 16px rgba(42,168,255,0.35)"></span> League Entertainment</div>
            <div class="league-count" id="count-entertainment">0</div>
          </div>
          <div class="league-thumb">
            <img src="2.png" alt="League Entertainment">
          </div>
          <p class="league-desc">Fun entertainment services on board</p>
          <div class="dropzone" data-drop="entertainment" aria-label="Drop services into League Entertainment">
            <p class="dropzone-empty">Drop services here.</p>
            <div class="assigned-list" id="list-entertainment"></div>
          </div>
        </div>

        <!-- Signature -->
        <div class="league" data-league="signature">
          <div class="league-head">
            <div class="league-name"><span class="league-badge" style="background:#56f2d6; box-shadow:0 0 16px rgba(86,242,214,0.32)"></span> League Signature</div>
            <div class="league-count" id="count-signature">0</div>
          </div>
          <div class="league-thumb">
            <img src="3.png" alt="League Signature">
          </div>
          <p class="league-desc">The services that make my customers feel unique</p>
          <div class="dropzone" data-drop="signature" aria-label="Drop services into League Signature">
            <p class="dropzone-empty">Drop services here.</p>
            <div class="assigned-list" id="list-signature"></div>
          </div>
        </div>

        <!-- Vortex -->
        <div class="league" data-league="vortex">
          <div class="league-head">
            <div class="league-name"><span class="league-badge" style="background:#ffffff; box-shadow:0 0 16px rgba(255,255,255,0.18)"></span> League Vortex</div>
            <div class="league-count" id="count-vortex">0</div>
          </div>
          <div class="league-thumb">
            <img src="4.png" alt="League Vortex">
          </div>
          <p class="league-desc">Services I don't see the need for, useless in my eyes</p>
          <div class="dropzone" data-drop="vortex" aria-label="Drop services into League Vortex">
            <p class="dropzone-empty">Drop services here.</p>
            <div class="assigned-list" id="list-vortex"></div>
          </div>
        </div>
      </section>

    </div>

    <div class="cta">
      <button class="btn-go" type="button" id="goBtn">LET'S GO!</button>
    </div>
  </div>

  <!-- Click-assign modal -->
  <div class="overlay" id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <div class="modal-top">
        <div>
          <p class="modal-title" id="mTitle">Assign service</p>
          <p class="modal-sub" id="mSub"></p>
        </div>
        <button class="modal-x" id="mClose" aria-label="Close">×</button>
      </div>
      <div class="modal-body">
        <div class="pick">
          <button type="button" data-pick="essentials">League Essentials</button>
          <button type="button" data-pick="entertainment">League Entertainment</button>
          <button type="button" data-pick="signature">League Signature</button>
          <button type="button" data-pick="vortex">League Vortex</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" aria-live="polite"></div>

  <script>
    /* =========================================================
      DATA (your list – structured by category)
    ========================================================= */
    const SERVICE_GROUPS = [
      {
        title: "Improves the service offering",
        items: ["Software over the Air"]
      },
      {
        title: "Optimise the maintenance",
        items: [
          "Telemaintenance",
          "NFT Certificate",
          "Real time vehicle health alert",
          "Vehicle Health Report"
        ]
      },
      {
        title: "Safety and security",
        items: [
          "Emergency call and Brand assistant",
          "EVAS",
          "Connected Alarm",
          "Stolen Vehicle tracking"
        ]
      },
      {
        title: "Interact remotly with the vehicle",
        items: [
          "Remote control",
          "e-Remote control (Charge, climate, Partial Charge...)",
          "My Trip Report",
          "Driving statistics",
          "On demand Services",
          "Vehicle finder"
        ]
      },
      {
        title: "Optimise your navigation",
        items: [
          "Driving statistic",
          "Find my car",
          "Natural Voice Recognition",
          "ChatGPT",
          "Connected navigation (with Real live traffic, live speedcam, POI Search, parking finder, live weather, starging station finder, in car special offers, on street parking, map update over the air...)",
          "Geofencing",
          "e-Routes by Free2move Charge",
          "EV Trip Planner",
          "EV Routing embedded"
        ]
      },
      {
        title: "Improvise the performance of the vehicle",
        items: [
          "e-coaching",
          "energy coach",
          "battery certificate"
        ]
      }
    ];

    const LEAGUES = ["essentials","entertainment","signature","vortex"];

    // State: serviceId -> league (or null)
    const state = new Map();

    // Build a stable ID from label
    const toId = (s) => s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");

    // Flatten services
    const allServices = [];
    SERVICE_GROUPS.forEach(g => g.items.forEach(label => {
      allServices.push({ id: toId(label), label, group: g.title });
    }));

    // Initialize
    allServices.forEach(s => state.set(s.id, null));

    /* =========================================================
      RENDER: services panel
    ========================================================= */
    const servicesRoot = document.getElementById("servicesRoot");
    const countPill = document.getElementById("countPill");
    const search = document.getElementById("search");

    function renderServices(){
      const q = (search.value || "").trim().toLowerCase();

      servicesRoot.innerHTML = "";
      let visibleCount = 0;

      SERVICE_GROUPS.forEach(group => {
        // filter group items by query
        const items = group.items
          .map(label => ({ id: toId(label), label }))
          .filter(x => !q || x.label.toLowerCase().includes(q));

        if (!items.length) return;

        const sec = document.createElement("div");
        sec.className = "svc-section";

        const h = document.createElement("p");
        h.className = "svc-h";
        h.textContent = group.title;
        sec.appendChild(h);

        const list = document.createElement("div");
        list.className = "svc-list";

        items.forEach(item => {
          visibleCount++;

          const assigned = state.get(item.id) !== null;

          const chip = document.createElement("div");
          chip.className = "svc";
          chip.setAttribute("draggable", "true");
          chip.dataset.id = item.id;
          chip.dataset.assigned = assigned ? "true" : "false";
          chip.setAttribute("role","button");
          chip.setAttribute("tabindex","0");
          chip.setAttribute("aria-label", assigned ? `${item.label} (assigned)` : item.label);

          chip.innerHTML = `
            <span class="dot" aria-hidden="true"></span>
            <span class="label">${item.label}</span>
            ${assigned ? `<span class="x" title="Remove" aria-label="Remove">×</span>` : ``}
          `;

          // Drag
          chip.addEventListener("dragstart", (e) => {
            e.dataTransfer.setData("text/plain", item.id);
            e.dataTransfer.effectAllowed = "move";
          });

          // Click assign (or remove)
          chip.addEventListener("click", (e) => {
            const isRemove = e.target && e.target.classList.contains("x");
            if (isRemove){
              unassign(item.id);
              return;
            }
            openAssignModal(item.id, item.label);
          });

          // Keyboard
          chip.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " "){
              e.preventDefault();
              openAssignModal(item.id, item.label);
            }
          });

          list.appendChild(chip);
        });

        sec.appendChild(list);
        servicesRoot.appendChild(sec);
      });

      countPill.textContent = `${visibleCount}`;
      sendHeightDelayed();
    }

    /* =========================================================
      RENDER: leagues
    ========================================================= */
    function renderLeagues(){
      LEAGUES.forEach(lg => {
        const list = document.getElementById(`list-${lg}`);
        const count = document.getElementById(`count-${lg}`);
        list.innerHTML = "";

        const assignedIds = [];
        state.forEach((val, id) => { if (val === lg) assignedIds.push(id); });

        count.textContent = `${assignedIds.length}`;

        const empty = list.parentElement.querySelector(".dropzone-empty");
        empty.style.display = assignedIds.length ? "none" : "block";

        assignedIds
          .map(id => allServices.find(s => s.id === id))
          .filter(Boolean)
          .sort((a,b) => a.label.localeCompare(b.label))
          .forEach(svc => {
            const chip = document.createElement("div");
            chip.className = "svc";
            chip.setAttribute("draggable", "true");
            chip.dataset.id = svc.id;
            chip.dataset.assigned = "true";
            chip.innerHTML = `
              <span class="dot" aria-hidden="true"></span>
              <span class="label">${svc.label}</span>
              <span class="x" title="Remove" aria-label="Remove">×</span>
            `;

            chip.addEventListener("dragstart", (e) => {
              e.dataTransfer.setData("text/plain", svc.id);
              e.dataTransfer.effectAllowed = "move";
            });

            chip.addEventListener("click", (e) => {
              if (e.target && e.target.classList.contains("x")){
                unassign(svc.id);
              }else{
                // quick re-assign
                openAssignModal(svc.id, svc.label);
              }
            });

            list.appendChild(chip);
          });
      });

      sendHeightDelayed();
    }

    /* =========================================================
      ASSIGN / UNASSIGN
    ========================================================= */
    function assign(serviceId, league){
      const prev = state.get(serviceId);
      state.set(serviceId, league);
      renderLeagues();
      renderServices();

      const svc = allServices.find(s => s.id === serviceId);
      const label = svc ? svc.label : "Service";
      if (prev && prev !== league){
        toast(`${label} moved to ${leagueLabel(league)}.`);
      } else {
        toast(`${label} assigned to ${leagueLabel(league)}.`);
      }
    }

    function unassign(serviceId){
      const svc = allServices.find(s => s.id === serviceId);
      state.set(serviceId, null);
      renderLeagues();
      renderServices();
      toast(`${svc ? svc.label : "Service"} removed.`);
    }

    function leagueLabel(lg){
      if (lg === "essentials") return "League Essentials";
      if (lg === "entertainment") return "League Entertainment";
      if (lg === "signature") return "League Signature";
      if (lg === "vortex") return "League Vortex";
      return lg;
    }

    /* =========================================================
      DROPZONES
    ========================================================= */
    const dropzones = Array.from(document.querySelectorAll(".dropzone"));
    dropzones.forEach(zone => {
      zone.addEventListener("dragover", (e) => {
        e.preventDefault();
        zone.classList.add("is-over");
        e.dataTransfer.dropEffect = "move";
      });

      zone.addEventListener("dragleave", () => zone.classList.remove("is-over"));

      zone.addEventListener("drop", (e) => {
        e.preventDefault();
        zone.classList.remove("is-over");
        const id = e.dataTransfer.getData("text/plain");
        const league = zone.dataset.drop;
        if (id && league){
          assign(id, league);
        }
      });
    });

    /* =========================================================
      CLICK-ASSIGN MODAL
    ========================================================= */
    const overlay = document.getElementById("overlay");
    const mSub = document.getElementById("mSub");
    const mClose = document.getElementById("mClose");
    let modalServiceId = null;

    function openAssignModal(id, label){
      modalServiceId = id;
      mSub.textContent = label;
      overlay.style.display = "flex";
      overlay.setAttribute("aria-hidden","false");
      sendHeightDelayed();
    }
    function closeAssignModal(){
      overlay.style.display = "none";
      overlay.setAttribute("aria-hidden","true");
      modalServiceId = null;
      sendHeightDelayed();
    }
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeAssignModal();
    });
    mClose.addEventListener("click", closeAssignModal);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && overlay.style.display === "flex") closeAssignModal();
    });

    Array.from(document.querySelectorAll("[data-pick]")).forEach(btn => {
      btn.addEventListener("click", () => {
        if (!modalServiceId) return;
        assign(modalServiceId, btn.dataset.pick);
        closeAssignModal();
      });
    });

    /* =========================================================
      SEARCH
    ========================================================= */
    search.addEventListener("input", () => renderServices());

    /* =========================================================
      CTA (always active)
    ========================================================= */
    document.getElementById("goBtn").addEventListener("click", () => {
      // TODO: replace with your target URL / next step
      // window.location.href = "YOUR_NEXT_PAGE_URL";
      console.log("LET'S GO clicked (always active).");
    });

    /* =========================================================
      TOAST
    ========================================================= */
    const toastEl = document.getElementById("toast");
    let toastT = null;
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(toastT);
      toastT = setTimeout(() => toastEl.classList.remove("show"), 1600);
    }

    /* =========================================================
      SHAREPOINT IFRAME AUTO-RESIZE (kept)
    ========================================================= */
    function sendHeight() {
      parent.postMessage(
        { type: "resizeLabChallenge1", height: document.documentElement.scrollHeight },
        "*"
      );
    }
    function sendHeightDelayed(){ setTimeout(sendHeight, 220); }

    window.addEventListener("load", () => { renderServices(); renderLeagues(); sendHeight(); setInterval(sendHeight, 900); });
    window.addEventListener("resize", sendHeight);
  </script>
</body>
</html>
